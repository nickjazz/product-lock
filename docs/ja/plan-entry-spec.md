---
layout: default
title: プランエントリー仕様
nav_order: 7
permalink: /ja/plan-entry-spec
lang: ja
lang_label: 日本語
page_id: plan-entry-spec
---

# Product Plan エントリー仕様書

### バージョン 0.1.0 — 2026年2月

> プランエントリーは、開発前および開発中の実装計画を記録する。
>
> すべてのプランは `plans/` ディレクトリに格納され、単一の `product.plan.md` ファイルを置き換える。
>
> Plan = HOW & WHY（AIが何をするつもりか）。Worklog = WHAT & WHEN（AIが実際に何をしたか）。

完全なロック仕様については、[Product Lock Specification](https://spec.productlock.org) を参照のこと。

---

## 目次

1. [他のファイルとの関係](#1-他のファイルとの関係)
2. [設計原則](#2-設計原則)
3. [ディレクトリと命名規則](#3-ディレクトリと命名規則)
4. [フォーマット](#4-フォーマット)
5. [必須セクション](#5-必須セクション)
6. [任意セクション — 一般](#6-任意セクション--一般)
7. [任意セクション — フルブループリント](#7-任意セクション--フルブループリント)
8. [Plan と Worklog の比較](#8-plan-と-worklog-の比較)

---

## 1. 他のファイルとの関係

```
plans/*.md        →  プラン（HOW & WHY — AIが何をするつもりか）
worklogs/*.md     →  記録（WHAT & WHEN — AIが実際に何をしたか）
product.lock.json →  境界（WHAT — プロダクトが何であるか）
```

Plan と Worklog は独立しているが補完的である：
- **Plan = 事前** — 意図、アプローチ、ステップ、リスクを記録
- **Worklog = 事後** — 実際の変更、決定、発見を記録
- 日付/タイトルで緩やかに関連付け、1:1の強制対応なし

`plans/` ディレクトリは単一の `product.plan.md` ファイルを置き換える。完全なプロダクトブループリントから軽量なセッションプランまで、すべてのプランが同じディレクトリに格納され、内容と命名で自然に区別される。

---

## 2. 設計原則

1. **実行可能** — プランはAIが実装に従える具体的なガイドである
2. **スコープ付き** — 各プランには明確な目標と境界がある
3. **プレーンテキスト** — Markdown形式、人間が読める
4. **柔軟な粒度** — 完全なプロダクトブループリントから単一セッションのタスクプランまで
5. **非ブロッキング** — プランは存在するために承認を必要としない。意図を文書化する

---

## 3. ディレクトリと命名規則

プランはプロジェクトルートの `plans/` ディレクトリに配置しなければならない（MUST）。

**命名規則：** `{YYYY-MM-DD}-{kebab-title}.md`

例：
- `plans/2026-02-17-add-payment-entity.md`
- `plans/2026-02-18-full-product-blueprint.md`
- `plans/2026-02-19-refactor-auth-flow.md`

```
project-root/
├── product.lock.json
├── plans/
│   ├── 2026-02-17-add-payment-entity.md
│   ├── 2026-02-18-full-product-blueprint.md
│   └── 2026-02-19-refactor-auth-flow.md
└── worklogs/
    └── ...
```

---

## 4. フォーマット

```markdown
# Plan: {title}

### Context
- Date: {YYYY-MM-DD}
- Branch: `{branch}`
- Agent: {誰がこのプランを作成したか}
- Lock version: {バージョン}
- PLS: {スコア}
- Scope: {スコープの説明}

### Goal
{このプランが達成しようとすること — 1-3文。}

### Approach
{ハイレベルな戦略 — 目標をどう達成するか。}

### Steps
1. {最初のステップ}
2. {2番目のステップ}
3. ...
```

---

## 5. 必須セクション

すべてのプランエントリーは以下のセクションを含まなければならない（MUST）。

### 5.1 Context

プランが作成された時期と場所に関するメタデータ。

| フィールド | 必須 | 説明 |
|-----------|------|------|
| Date | はい | `YYYY-MM-DD` |
| Branch | はい | Gitブランチ名 |
| Agent | いいえ | 誰がプランを作成したか（デフォルト：「AI」） |
| Lock version | いいえ | 現在のロックバージョン |
| PLS | いいえ | 現在のPLSスコア |
| Scope | いいえ | 簡単なスコープの説明 |

### 5.2 Goal

このプランが達成しようとすることを1〜3文で記述する。これは成功基準であり、目標が達成されたらプランは完了である。

ルール：
- 具体的かつ測定可能でなければならない（MUST）
- 適用可能な場合、ロック概念（entities、features）を参照すべきである（SHOULD）
- 最大1〜3文

### 5.3 Approach

ハイレベルな戦略。「どのように」と「なぜ」を説明する。関連する場合、検討した代替案に言及する。

### 5.4 Steps

順序付きの番号付き実装ステップリスト。

ルール：
- 番号付き、順序付き
- 各ステップは可能な場合、独立して検証可能であるべき（SHOULD）
- 3〜15ステップを目標とする
- 命令形を使用：「Xを追加」「Yを更新」「Zを設定」

---

## 6. 任意セクション — 一般

プランに関連する場合にこれらのセクションを含める。

### 6.1 Background

追加のコンテキスト：先行技術、関連issue、ユーザーリクエスト。

### 6.2 Constraints

アプローチを形作る既知の制限や要件。

```markdown
### Constraints
- 既存のAPIを壊してはならない
- レスポンスタイムは200ms以下
- Node 18+で動作すること
```

### 6.3 Risks

潜在的な問題とその緩和策。

```markdown
### Risks
- Stripe webhookの配信が遅延する可能性 — 冪等キーを実装
- 大きなテーブルのデータベースマイグレーション — オフピーク時に実行
```

### 6.4 Expected Outcome

プラン実行後にコードベースがどのようになるべきか。レビュアーの検証に有用。

### 6.5 References

issue、PR、仕様、または外部リソースへのリンク。

---

## 7. 任意セクション — フルブループリント

包括的なプロダクトプラン（旧 `product.plan.md` の代替）の場合、以下の追加セクションを含めることができる：

| セクション | 含めるタイミング |
|-----------|----------------|
| Stack | 各レイヤーの技術選定 |
| Schemas | 型、制約、リレーションを含む完全なエンティティ定義 |
| Endpoints | 各機能のAPIコントラクト |
| Architecture | 非自明なシステムパターン（マイクロサービス、CQRSなど） |
| Auth & Permissions | 認証方法、セッション管理、ロールマッピング、RLS |
| File Structure | 非標準のプロジェクトレイアウト |

これらのセクションは[プラン仕様](/ja/plan-spec)で説明されているのと同じフォーマットに従う。

---

## 8. Plan と Worklog の比較

| 側面 | Plan | Worklog |
|------|------|---------|
| タイミング | 実装前/中 | 実装後 |
| 目的 | 意図とアプローチ（HOW & WHY） | 実際の変更（WHAT & WHEN） |
| 内容 | 目標、アプローチ、ステップ、リスク | 変更、ファイル、決定 |
| 粒度 | 柔軟（ブループリントからタスクまで） | セッションごと |
| 検証 | レビュアーがコードとプランの一致を確認 | レビュアーがワークログと変更の一致を確認 |
| ディレクトリ | `plans/` | `worklogs/` |
| 命名 | `{YYYY-MM-DD}-{kebab-title}.md` | `{YYYY-MM-DD}-{kebab-title}.md` |

### レビュアー統合

プロダクトをレビューする際、AIレビュアーはプランとコードベースを照合し、以下を報告する：

| ステータス | 意味 |
|-----------|------|
| MATCH | 実装がプランと一致している |
| DEVIATION | 実装がプランと大きく異なる |
| INCOMPLETE | プランが部分的にのみ実装されている |
| UNPLANNED | 対応するプランのない重要なコードが存在する |

---

*この仕様は [Product Lock Specification](https://spec.productlock.org) の一部です。*
